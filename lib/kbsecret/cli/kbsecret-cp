#!/usr/bin/env ruby
# frozen_string_literal: true

require "kbsecret"
require "tty-prompt"

include KBSecret

cmd = CLI.create do |c|
  c.slop do |o|
    o.banner = <<~HELP
      Usage:
        kbsecret cp [options] <target-session> <record> [record]
    HELP

    o.string "-s", "--session", "the session containing the record", default: :default
    o.bool "-m", "--move", "delete the record after copying"
  end

  c.dreck do
    string :target_session
    string :label
  end

  c.ensure_session!
end

target_session_label    = cmd.args[:target_session]
label                   = cmd.args[:label]
target_session          = Session.new(label: target_session_label)
record                  = cmd.session[label]

cmd.die "Unable to find record #{label}" unless cmd.session.record?(label)

target_session.import_record(record)
cmd.session.delete_record(record.label) if cmd.opts.move?
